@prefix evrepo: <https://vocab.evidence-repository.org/> .
@prefix rdf:    <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:   <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl:    <http://www.w3.org/2002/07/owl#> .
@prefix xsd:    <http://www.w3.org/2001/XMLSchema#> .
@prefix skos:   <http://www.w3.org/2004/02/skos/core#> .

# =============================================================================
# Evidence Repository Core Vocabulary
# Namespace: https://vocab.evidence-repository.org/
#
# Domain-agnostic structural model for evidence. Defines the core classes,
# the CodingAnnotation pattern, and structural relationships shared across
# sector vocabularies (education, health, climate, etc.).
# =============================================================================

evrepo: a owl:Ontology ;
    rdfs:label "Evidence Repository Core Vocabulary"@en ;
    rdfs:comment "Foundational infrastructure for evidence repositories. Defines the evidence graph structure and the CodingAnnotation provenance pattern."@en .

# =============================================================================
# Core Domain Classes
# =============================================================================

evrepo:LinkedDataEnhancement a owl:Class ;
    rdfs:label "Linked Data Enhancement"@en ;
    rdfs:comment "A structured linked-data annotation attached to a Reference in the repository. Contains one or more Investigations."@en .

evrepo:Investigation a owl:Class ;
    rdfs:label "Investigation"@en ;
    rdfs:comment "A study reported within a Reference. An Investigation produces one or more Findings."@en .

evrepo:Finding a owl:Class ;
    rdfs:label "Finding"@en ;
    rdfs:comment "The atomic unit of evidence — a single comparison for a specific outcome. A Finding evaluates one Condition compared to another, with Context describing the setting, Outcome describing what was measured, and ObservedResult/EffectEstimate carrying the quantitative data."@en .

evrepo:Context a owl:Class ;
    rdfs:label "Context"@en ;
    rdfs:comment "The 'Given' component of a Finding — describes country, education level, setting, sample features, and participants."@en .

evrepo:Outcome a owl:Class ;
    rdfs:label "Outcome"@en ;
    rdfs:comment "What was measured — the educational or other outcome type and description. Orthogonal to the conditions being compared."@en .

# =============================================================================
# Condition Hierarchy
#
# A Condition represents the circumstances under which observations were made.
# This unifies intervention arms, control conditions, and temporal measurement
# occasions under a single type so that evaluates/comparedTo works uniformly
# across RCTs, pre-post designs, interrupted time series, and DiD.
# =============================================================================

evrepo:Condition a owl:Class ;
    rdfs:label "Condition"@en ;
    rdfs:comment "A state or context in which measurements were taken — the circumstances under which observations were made."@en .

evrepo:Intervention a owl:Class ;
    rdfs:subClassOf evrepo:Condition ;
    rdfs:label "Intervention"@en ;
    rdfs:comment "An active treatment or programme. Carries coded properties describing the intervention's characteristics (theme, duration, fidelity, funder, etc.)."@en .

evrepo:ControlCondition a owl:Class ;
    rdfs:subClassOf evrepo:Condition ;
    rdfs:label "Control Condition"@en ;
    rdfs:comment "A comparison state without the intervention of interest (e.g. business-as-usual, waitlist, active control, placebo)."@en .

evrepo:TemporalCondition a owl:Class ;
    rdfs:subClassOf evrepo:Condition ;
    rdfs:label "Temporal Condition"@en ;
    rdfs:comment "A time-defined measurement occasion (e.g. pre-test, post-test, follow-up, pre-policy period)."@en .

# =============================================================================
# ObservedResult and EffectEstimate
# =============================================================================

evrepo:ObservedResult a owl:Class ;
    rdfs:label "Observed Result"@en ;
    rdfs:comment "Raw summary statistics for a single arm/condition as reported in the study. Each ObservedResult is linked to its Condition via forCondition, making it self-describing. Provenance (codedBy, supportingText) is at the class level, not per-field."@en .

evrepo:EffectEstimate a owl:Class ;
    rdfs:label "Effect Estimate"@en ;
    rdfs:comment "A computed or reported effect size estimate derived from ObservedResults or extracted from the paper. Multiple EffectEstimates per Finding are permitted (e.g. unadjusted, baseline-adjusted, author-reported)."@en .

# =============================================================================
# Structural Relationships
# =============================================================================

evrepo:hasInvestigation a owl:ObjectProperty ;
    rdfs:label "has investigation"@en ;
    rdfs:domain evrepo:LinkedDataEnhancement ;
    rdfs:range evrepo:Investigation .

evrepo:hasFinding a owl:ObjectProperty ;
    rdfs:label "has finding"@en ;
    rdfs:domain evrepo:Investigation ;
    rdfs:range evrepo:Finding .

evrepo:hasContext a owl:ObjectProperty ;
    rdfs:label "has context"@en ;
    rdfs:domain evrepo:Finding ;
    rdfs:range evrepo:Context .

evrepo:hasOutcome a owl:ObjectProperty ;
    rdfs:label "has outcome"@en ;
    rdfs:domain evrepo:Finding ;
    rdfs:range evrepo:Outcome .

# --- Comparison structure ---

evrepo:evaluates a owl:ObjectProperty ;
    rdfs:label "evaluates"@en ;
    rdfs:domain evrepo:Finding ;
    rdfs:range evrepo:Condition ;
    rdfs:comment "The condition being evaluated. A positive effect size means this condition outperformed the comparedTo condition."@en .

evrepo:comparedTo a owl:ObjectProperty ;
    rdfs:label "compared to"@en ;
    rdfs:domain evrepo:Finding ;
    rdfs:range evrepo:Condition ;
    rdfs:comment "The condition being compared against (control, pre-test, etc.)."@en .

# --- Quantitative data ---

evrepo:hasArmData a owl:ObjectProperty ;
    rdfs:label "has arm data"@en ;
    rdfs:domain evrepo:Finding ;
    rdfs:range evrepo:ObservedResult ;
    rdfs:comment "Links a Finding to per-arm summary statistics. A two-arm trial typically has two ObservedResults; multi-arm trials have more."@en .

evrepo:hasEffectEstimate a owl:ObjectProperty ;
    rdfs:label "has effect estimate"@en ;
    rdfs:domain evrepo:Finding ;
    rdfs:range evrepo:EffectEstimate .

evrepo:derivedFrom a owl:ObjectProperty ;
    rdfs:label "derived from"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range evrepo:ObservedResult ;
    rdfs:comment "Links an EffectEstimate back to the ObservedResult(s) it was computed from."@en .

evrepo:forCondition a owl:ObjectProperty ;
    rdfs:label "for condition"@en ;
    rdfs:domain evrepo:ObservedResult ;
    rdfs:range evrepo:Condition ;
    rdfs:comment "Which condition this arm data is for. Makes each ObservedResult self-describing without traversing back to the Finding."@en .

# =============================================================================
# CodingAnnotation Pattern — Base Class and Properties
# =============================================================================

evrepo:CodingAnnotation a owl:Class ;
    rdfs:label "Coding Annotation"@en ;
    rdfs:comment "A coded value with provenance from source material. Wraps each coded property value with supporting text, coder identity, and coding status."@en .

# --- Base Properties ---
# Note: codedValue, supportingText, codedBy are rdf:Property (not owl:ObjectProperty
# or owl:DatatypeProperty) because codedValue must be polymorphic — it holds
# xsd:string on StringCodingAnnotation, xsd:decimal on NumericCodingAnnotation,
# and @id references on concept-typed annotations. OWL restrictions on each
# subclass constrain the actual value type.

evrepo:codedValue a rdf:Property ;
    rdfs:label "coded value"@en ;
    rdfs:domain evrepo:CodingAnnotation ;
    rdfs:comment "The extracted value. Type varies by CodingAnnotation subclass."@en .

evrepo:supportingText a rdf:Property ;
    rdfs:label "supporting text"@en ;
    rdfs:domain [ a owl:Class ;
        owl:unionOf ( evrepo:CodingAnnotation evrepo:ObservedResult evrepo:EffectEstimate )
    ] ;
    rdfs:range xsd:string ;
    rdfs:comment "Verbatim or near-verbatim text from the source material that supports the coded value."@en .

evrepo:codedBy a rdf:Property ;
    rdfs:label "coded by"@en ;
    rdfs:domain [ a owl:Class ;
        owl:unionOf ( evrepo:CodingAnnotation evrepo:ObservedResult evrepo:EffectEstimate )
    ] ;
    rdfs:comment "The agent (human coder or LLM) who performed the coding."@en .

evrepo:sourceLocation a rdf:Property ;
    rdfs:label "source location"@en ;
    rdfs:domain [ a owl:Class ;
        owl:unionOf ( evrepo:ObservedResult evrepo:EffectEstimate )
    ] ;
    rdfs:range xsd:string ;
    rdfs:comment "Location in the source document where the data was found (e.g. table number, page reference)."@en .

# --- Coding Status Enumeration ---
# A closed set of named individuals representing workflow states of a
# CodingAnnotation. The fourth state — "not yet coded" — is represented by
# the absence of a CodingAnnotation entirely, so it has no named individual.

evrepo:CodingStatus a owl:Class ;
    rdfs:label "Coding Status"@en ;
    rdfs:comment "The lifecycle state of a coding annotation."@en ;
    owl:oneOf ( evrepo:coded evrepo:notApplicable evrepo:notReported ) .

evrepo:coded a owl:NamedIndividual , evrepo:CodingStatus ;
    rdfs:label "Coded"@en ;
    rdfs:comment "A codedValue is present — the field has been coded from the source."@en .

evrepo:notApplicable a owl:NamedIndividual , evrepo:CodingStatus ;
    rdfs:label "Not Applicable"@en ;
    rdfs:comment "The coder determined the field is irrelevant to this finding (e.g. effect size for a qualitative study). No codedValue is expected."@en .

evrepo:notReported a owl:NamedIndividual , evrepo:CodingStatus ;
    rdfs:label "Not Reported"@en ;
    rdfs:comment "The required information is not disclosed in the source material. No codedValue is expected."@en .

evrepo:status a owl:ObjectProperty ;
    rdfs:label "status"@en ;
    rdfs:domain evrepo:CodingAnnotation ;
    rdfs:range evrepo:CodingStatus ;
    rdfs:comment "The lifecycle state of this coding annotation."@en .

# =============================================================================
# Literal-Typed CodingAnnotation Subclasses (core project)
# =============================================================================

evrepo:StringCodingAnnotation a owl:Class ;
    rdfs:subClassOf evrepo:CodingAnnotation ;
    rdfs:label "String Coding Annotation"@en ;
    rdfs:comment "CodingAnnotation where codedValue is a string literal."@en ;
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty evrepo:codedValue ;
        owl:allValuesFrom xsd:string
    ] .

evrepo:NumericCodingAnnotation a owl:Class ;
    rdfs:subClassOf evrepo:CodingAnnotation ;
    rdfs:label "Numeric Coding Annotation"@en ;
    rdfs:comment "CodingAnnotation where codedValue is a decimal or integer."@en ;
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty evrepo:codedValue ;
        owl:allValuesFrom xsd:decimal
    ] .

# =============================================================================
# ObservedResult Properties — Per-Arm Summary Statistics
#
# Each ObservedResult holds data for one arm/condition. Generic property names
# (n, mean, sd) because the arm identity is carried by forCondition.
# =============================================================================

evrepo:n a owl:DatatypeProperty ;
    rdfs:label "sample size"@en ;
    rdfs:domain evrepo:ObservedResult ;
    rdfs:range xsd:integer .

evrepo:mean a owl:DatatypeProperty ;
    rdfs:label "mean"@en ;
    rdfs:domain evrepo:ObservedResult ;
    rdfs:range xsd:decimal .

evrepo:sd a owl:DatatypeProperty ;
    rdfs:label "standard deviation"@en ;
    rdfs:domain evrepo:ObservedResult ;
    rdfs:range xsd:decimal .

evrepo:se a owl:DatatypeProperty ;
    rdfs:label "standard error"@en ;
    rdfs:domain evrepo:ObservedResult ;
    rdfs:range xsd:decimal ;
    rdfs:comment "Standard error of the mean. Alternative to sd when that is what is reported."@en .

evrepo:clusterCount a owl:DatatypeProperty ;
    rdfs:label "cluster count"@en ;
    rdfs:domain evrepo:ObservedResult ;
    rdfs:range xsd:integer ;
    rdfs:comment "Number of clusters (schools, classrooms, etc.) for cluster RCTs."@en .

evrepo:icc a owl:DatatypeProperty ;
    rdfs:label "intraclass correlation coefficient"@en ;
    rdfs:domain evrepo:ObservedResult ;
    rdfs:range xsd:decimal .

evrepo:preMean a owl:DatatypeProperty ;
    rdfs:label "pre-test mean"@en ;
    rdfs:domain evrepo:ObservedResult ;
    rdfs:range xsd:decimal .

evrepo:preSd a owl:DatatypeProperty ;
    rdfs:label "pre-test standard deviation"@en ;
    rdfs:domain evrepo:ObservedResult ;
    rdfs:range xsd:decimal .

evrepo:events a owl:DatatypeProperty ;
    rdfs:label "number of events"@en ;
    rdfs:domain evrepo:ObservedResult ;
    rdfs:range xsd:integer ;
    rdfs:comment "Number of events for binary outcomes."@en .

# =============================================================================
# EffectEstimate Properties
# =============================================================================

evrepo:pointEstimate a owl:DatatypeProperty ;
    rdfs:label "point estimate"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range xsd:decimal .

evrepo:standardError a owl:DatatypeProperty ;
    rdfs:label "standard error"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range xsd:decimal .

evrepo:variance a owl:DatatypeProperty ;
    rdfs:label "variance"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range xsd:decimal .

evrepo:confidenceLevel a owl:DatatypeProperty ;
    rdfs:label "confidence level"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range xsd:decimal ;
    rdfs:comment "e.g. 0.95 for a 95% confidence interval."@en .

evrepo:confidenceIntervalLower a owl:DatatypeProperty ;
    rdfs:label "confidence interval lower bound"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range xsd:decimal .

evrepo:confidenceIntervalUpper a owl:DatatypeProperty ;
    rdfs:label "confidence interval upper bound"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range xsd:decimal .

evrepo:baselineAdjusted a owl:DatatypeProperty ;
    rdfs:label "baseline adjusted"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range xsd:boolean .

evrepo:clusteringAdjusted a owl:DatatypeProperty ;
    rdfs:label "clustering adjusted"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range xsd:string ;
    rdfs:comment "Whether clustering was accounted for. Values: yes, no, unknown, not-applicable."@en .

# --- Effect size provenance (ObjectProperties pointing to SKOS concepts) ---

evrepo:effectSizeMetric a owl:ObjectProperty ;
    rdfs:label "effect size metric"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range evrepo:EffectSizeMetricConcept ;
    rdfs:comment "What metric was used: Hedges' g, Cohen's d, odds ratio, etc."@en .

evrepo:estimateSource a owl:ObjectProperty ;
    rdfs:label "estimate source"@en ;
    rdfs:domain evrepo:EffectEstimate ;
    rdfs:range evrepo:EstimateSourceConcept ;
    rdfs:comment "How this estimate was obtained: computed from summary stats, extracted from paper, etc."@en .

# =============================================================================
# Core SKOS Concept Schemes — EffectSizeMetric and EstimateSource
#
# These are domain-agnostic and belong in the core vocabulary.
# =============================================================================

# --- Effect Size Metric ---

evrepo:EffectSizeMetricConcept a owl:Class ;
    rdfs:subClassOf skos:Concept ;
    rdfs:label "Effect Size Metric Concept"@en .

evrepo:EffectSizeMetricScheme a skos:ConceptScheme ;
    rdfs:label "Effect Size Metric"@en ;
    rdfs:comment "Controlled vocabulary of effect size metrics."@en ;
    skos:hasTopConcept evrepo:hedgesG , evrepo:cohensD , evrepo:glassDelta ,
        evrepo:oddsRatio , evrepo:riskRatio , evrepo:meanDifference ,
        evrepo:correlationR .

evrepo:hedgesG a evrepo:EffectSizeMetricConcept , skos:Concept ;
    skos:inScheme evrepo:EffectSizeMetricScheme ;
    skos:topConceptOf evrepo:EffectSizeMetricScheme ;
    skos:prefLabel "Hedges' g"@en .

evrepo:cohensD a evrepo:EffectSizeMetricConcept , skos:Concept ;
    skos:inScheme evrepo:EffectSizeMetricScheme ;
    skos:topConceptOf evrepo:EffectSizeMetricScheme ;
    skos:prefLabel "Cohen's d"@en .

evrepo:glassDelta a evrepo:EffectSizeMetricConcept , skos:Concept ;
    skos:inScheme evrepo:EffectSizeMetricScheme ;
    skos:topConceptOf evrepo:EffectSizeMetricScheme ;
    skos:prefLabel "Glass's delta"@en .

evrepo:oddsRatio a evrepo:EffectSizeMetricConcept , skos:Concept ;
    skos:inScheme evrepo:EffectSizeMetricScheme ;
    skos:topConceptOf evrepo:EffectSizeMetricScheme ;
    skos:prefLabel "Odds ratio"@en .

evrepo:riskRatio a evrepo:EffectSizeMetricConcept , skos:Concept ;
    skos:inScheme evrepo:EffectSizeMetricScheme ;
    skos:topConceptOf evrepo:EffectSizeMetricScheme ;
    skos:prefLabel "Risk ratio"@en .

evrepo:meanDifference a evrepo:EffectSizeMetricConcept , skos:Concept ;
    skos:inScheme evrepo:EffectSizeMetricScheme ;
    skos:topConceptOf evrepo:EffectSizeMetricScheme ;
    skos:prefLabel "Mean difference"@en .

evrepo:correlationR a evrepo:EffectSizeMetricConcept , skos:Concept ;
    skos:inScheme evrepo:EffectSizeMetricScheme ;
    skos:topConceptOf evrepo:EffectSizeMetricScheme ;
    skos:prefLabel "Correlation (r)"@en .

# --- Estimate Source ---

evrepo:EstimateSourceConcept a owl:Class ;
    rdfs:subClassOf skos:Concept ;
    rdfs:label "Estimate Source Concept"@en .

evrepo:EstimateSourceScheme a skos:ConceptScheme ;
    rdfs:label "Estimate Source"@en ;
    rdfs:comment "Controlled vocabulary for how an effect estimate was obtained."@en ;
    skos:hasTopConcept evrepo:computedFromStats , evrepo:extractedFromPaper ,
        evrepo:convertedFromOther , evrepo:authorProvided .

evrepo:computedFromStats a evrepo:EstimateSourceConcept , skos:Concept ;
    skos:inScheme evrepo:EstimateSourceScheme ;
    skos:topConceptOf evrepo:EstimateSourceScheme ;
    skos:prefLabel "Computed from summary statistics"@en .

evrepo:extractedFromPaper a evrepo:EstimateSourceConcept , skos:Concept ;
    skos:inScheme evrepo:EstimateSourceScheme ;
    skos:topConceptOf evrepo:EstimateSourceScheme ;
    skos:prefLabel "Extracted from paper"@en .

evrepo:convertedFromOther a evrepo:EstimateSourceConcept , skos:Concept ;
    skos:inScheme evrepo:EstimateSourceScheme ;
    skos:topConceptOf evrepo:EstimateSourceScheme ;
    skos:prefLabel "Converted from other metric"@en .

evrepo:authorProvided a evrepo:EstimateSourceConcept , skos:Concept ;
    skos:inScheme evrepo:EstimateSourceScheme ;
    skos:topConceptOf evrepo:EstimateSourceScheme ;
    skos:prefLabel "Author provided"@en .
